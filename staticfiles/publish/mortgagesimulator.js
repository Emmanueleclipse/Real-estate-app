
/*! mortgagesimulator.js - Author: BienFacile, License: Bienfacile, more info: http://www.bienfacile.com/ */
function mortgage_set_field(a,b,c){if(c=='price')b=numberWithCommas(Math.round(b));else if(c=='percent')b=Math.round(b*100);$(a).val(b);}function mortgage_get_figures(){var a={price:parseInt($('#price').val().replace(',','')),mortgage_percent:$("#mortgage_percent").val()/100,mortgage_amount:parseInt($("#mortgage_amount").val().replace(',','')),interest_rate:$("#interest_rate").val(),repayment_years:$("#repayment_years").val(),income:$("#income").val().replace(',','')};a.total_repayment=compound_interest(a);a.monthly_repayments=Math.round(a.total_repayment/a.repayment_years/12);return a;}function mortgage_change_price(){var a=mortgage_get_figures();mortgage_set_loan(a);mortgage_set_income(a);show_costs(a);}function mortgage_change_percent(){var a=mortgage_get_figures();mortgage_set_field("#mortgage_amount",a.price*a.mortgage_percent,'price');mortgage_set_income(a);show_costs(a);}function mortgage_change_rate(){var a=mortgage_get_figures();mortgage_set_income(a);show_costs(a);}function mortgage_change_years(){var a=mortgage_get_figures();mortgage_set_income(a);show_costs(a);}function mortgage_set_income(a){mortgage_set_field("#income",a.monthly_repayments*3,'price');}function mortgage_change_amount(){var a=mortgage_get_figures();if(a.mortgage_amount>a.price*1.1){a.mortgage_amount=a.price*1.1;alert(a.mortgage_amount);mortgage_set_field('#mortgage_amount',a.mortgage_amount,'price');}mortgage_set_field("#mortgage_percent",a.mortgage_amount/a.price,'percent');mortgage_set_income(a);show_costs(a);}function mortgage_change_income(){var a=mortgage_get_figures();a.mortgage_amount=compound_reverse(a);a.price=Math.round(a.mortgage_amount/a.mortgage_percent);mortgage_set_price(a);mortgage_set_loan(a);show_costs(a);}function mortgage_set_loan(a){mortgage_set_field("#mortgage_amount",a.price*a.mortgage_percent,'price');}function mortgage_set_price(a){mortgage_set_field("#price",a.price,'price');}function calculateTotalCompoundInterest(a,b,c,d){return a*(Math.pow(1+b/c,c*d)-1);}function compound_interest(a){var b=parseFloat(a.mortgage_amount);var c=parseFloat(a.interest_rate);c=c/100;var d=1;var e=parseFloat(a.repayment_years);var f=c/d;var g=1+f;var h=d*e;var i=Math.pow(g,h);var j=(b*i);return Math.round(j);}function compound_reverse(a){var b=parseFloat(a.interest_rate);b=b/100;var c=1;var d=parseFloat(a.repayment_years);var e=b/c;var f=1+e;var g=c*d;var h=Math.pow(f,g);var i=parseFloat(a.income)/3*12*g;var j=(i/h);return Math.round(j);}function max_loan(a){var b=a.income/3;var c=a.repayment_years*12;var d=a.interest_rate/100/12;var e=Math.pow(1+d,c);var f=b/((d*e)/(e-1));return Math.round(f);}function init_costs(){var a={};a.price=getQueryStringValue('price')!=''?parseInt(getQueryStringValue('price')):250000;mortgage_set_price(a);a.mortgage_percent=(getQueryStringValue('mortgage_percent')!=''?parseInt(getQueryStringValue('mortgage_percent')):80);mortgage_set_field('#mortgage_percent',a.mortgage_percent,'integer');a.mortgage_percent=a.mortgage_percent/100;a.interest_rate=getQueryStringValue('interest_rate')!=''?parseInt(getQueryStringValue('interest_rate')):1.4;;mortgage_set_field('#interest_rate',a.interest_rate,'float');a.repayment_years=getQueryStringValue('repayment_years')!=''?parseInt(getQueryStringValue('repayment_years')):25;mortgage_set_field('#repayment_years',a.repayment_years,'integer');a.mortgage_amount=a.price*a.mortgage_percent;mortgage_set_loan(a);a.total_repayment=compound_interest(a);a.monthly_repayments=Math.round(a.total_repayment/a.repayment_years/12);mortgage_set_income(a);show_costs(a);}function show_costs(a){var b=a.price;var c=compound_interest(a);var d=a.mortgage_amount;var e=Math.round(b*0.078);var f=Math.round(250+d/1666+(192+(d-30000)*0.0028*1.2));var g=e+f;var h=b+g-d;$('#summary_price').html(showPrice(b));$('#summary_repayments').html(showPrice(a.monthly_repayments));$('#summary_cash').html(showPrice(h));$('#summary_total').html(showPrice(b+g));$('#summary_interest').html(showPrice(c-d));$('#cost_notaire').html(showPrice(e));$('#cost_loan').html(showPrice(f));}