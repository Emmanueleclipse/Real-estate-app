
/*! suppliers.js - Author: BienFacile, License: Bienfacile, more info: http://www.bienfacile.com/ */
suppliers=new FeedObject('/json_suppliers/');suppliers.me='suppliers';suppliers.all=function(a,b,c){c.isotope=false;output=[];c.wrapper='table';c.wrapper_class='table table-striped';c.childwrapper='tr';for(var d=0;d<b.length;d++){var e=b[d];output.push({'search':e.name.toLowerCase()+' '+e.tags.toLowerCase(),infinitescroll:e.infinitescroll,html:"<td><a href=\"javascript:suppliers.modal('#modal', { title : 'Modifier fournisseur', hidden: { id: "+e.id+" } });\">"+e.name+'</a></td><td>'+(e.tags?e.tags:'')+'</td><td>'+(e.description?e.description:'')+'</td>'});}this.list(a,output,c);};suppliers.form=function(){return [{type:'input',field:'name',title:'Fournisseur',required:true},{type:'textarea',field:'description',title:'Descriptif'},[[{type:'input',field:'siret',title:'SIRET'}],[{type:'input',field:'vat_number',title:'Numero TVA'}],[{type:'input',field:'category',title:'Categorie'}]],{type:'input',field:'tags',title:'Tags'}];};suppliers_facture=new FeedObject('/json_suppliers_facture/');suppliers_facture.me='suppliers_facture';suppliers_facture.all=function(a,b,c){var d,e;c.isotope=false;output=[];c.wrapper='table';c.wrapper_class='table table-striped';c.childwrapper='tr';for(var f=0;f<b.length;f++){d=b[f];e=concat_cells({'cell_open':"<td "+(d.paid!='true'?' style="background-color:red;"':'')+"><a href=\"javascript:suppliers_facture.modal('#modal', { title : 'Modifier facture', hidden: { id: "+d.id+" } });\">",'cell_close':'</a></td>','cells':[d.date,d.supplier,'&euro;'+d.amount,d.description]});output.push({'search':d.supplier.toLowerCase()+(d.description?' '+d.description.toLowerCase():''),infinitescroll:d.infinitescroll,html:e});}this.list(a,output,c);};suppliers_facture.form=function(){return [{type:'select2',field:'supplier',title:'Fournisseur',options:suppliers.options('name'),required:true},{type:'input',field:'invoice_number',title:'Numero facture',required:true},[[{type:'input',field:'amount',title:'Montant',required:true}],[{type:'boolean',field:'vat',title:'TVA inclus','default':'true'}],[{type:'boolean',field:'paid',title:'Paid','default':'false'}]],{type:'textarea',field:'description',title:'Descriptif'},{type:'date',field:'date',title:'Date du facture',required:true}];};
/*! notairefactures.js - Author: BienFacile, License: Bienfacile, more info: http://www.bienfacile.com/ */
notairefactures=new FeedObject('/json_notaire_factures/');notairefactures.me='notairefactures';notairefactures.all=function(a,b,c){c.isotope=false;output=[];c.wrapper='table';c.wrapper_class='table table-striped';c.childwrapper='tr';for(var d=0;d<b.length;d++){var e=b[d];html=concat_cells({'cell_open':"<td "+(e.paid!='true'?' style="background-color:red;"':'')+"><a href=\"javascript:notairefactures.modal('#modal', { title : 'Modifier facture', hidden: { id: "+e.id+" } });\">",'cell_close':'</a></td>','cells':[e.date,'#'+e.invoice_number,e.agent,e.client_name,e.property_address,showPrice(e.commission),e.notaire]});output.push({'search':e.client_name.toLowerCase()+' '+e.property_address.toLowerCase(),infinitescroll:e.infinitescroll,html:html});}this.list(a,output,c);};notairefactures.form=function(){return [[[{type:'input',field:'commission',title:'Commission','required':true}],[{type:'boolean',field:'paid',title:'Paid','default':false}],[{type:'boolean',field:'updatebank',title:'Mis a jour banque','default':true}]],[[{type:'input',field:'invoice_number',title:'Numero facture'}],[{type:'input',field:'notaire',title:'Notaire'}]],[[{type:'input',field:'client_name',title:'Nom client','required':true}],[{type:'input',field:'client_address',title:'Adresse client'}]],[[{type:'input',field:'property_address',title:'Adresse du bien','required':true}],[{type:'input',field:'other_agency',title:'Autre agence'}]],[[{type:'date',field:'date',title:'Date','required':true}],[{type:'select2',field:'agent_id',title:'Agent',options:myagency.options('fullname')}]]];};
/*! agentfactures.js - Author: BienFacile, License: Bienfacile, more info: http://www.bienfacile.com/ */
agentfactures=new FeedObject('/json_agent_factures/');agentfactures.me='agentfactures';agentfactures.all=function(a,b,c){c.isotope=false;output=[];c.wrapper='table';c.wrapper_class='table table-striped';c.childwrapper='tr';for(var d=0;d<b.length;d++){var e=b[d];html=concat_cells({'cell_open':"<td "+(e.paid!='true'?' style="background-color:red;"':'')+"><a href=\"javascript:agentfactures.modal('#modal', { title : 'Modifier facture', hidden: { id: "+e.id+" } });\">",'cell_close':'</a></td>','cells':[e.date,'#'+e.invoice_number,e.agent,e.sale,(e.commission?showPrice(e.commission):e.commission_percent+'%')]});output.push({infinitescroll:e.infinitescroll,html:html});}this.list(a,output,c);};agentfactures.form=function(){return [{type:'input',field:'invoice_number',title:'Numero facture'},[[{type:'select2',field:'agent_id',title:'Agent',options:myagency.options('fullname')}],[{type:'select2',field:'sale_id',title:'Vente',options:notairefactures.options('description')}]],[[{type:'select',field:'commission_percent',title:'Partage ',options:{'25':'25%','50':'50%'},width:3}]],[[{type:'input',field:'commission',title:'ou montant fixe'}],[{type:'boolean',field:'vat',title:'TVA inclus','default':'true'}],[{type:'boolean',field:'paid',title:'Paid','default':'false'}]],{type:'date',field:'date',title:'Date du facture',required:true}];};
/*! apporteurfactures.js - Author: BienFacile, License: Bienfacile, more info: http://www.bienfacile.com/ */
apporteurfactures=new FeedObject('/json_apporteur_factures/');apporteurfactures.me='apporteurfactures';apporteurfactures.all=function(a,b,c){c.isotope=false;output=[];c.wrapper='table';c.wrapper_class='table table-striped';c.childwrapper='tr';for(var d=0;d<b.length;d++){var e=b[d];html=concat_cells({'cell_open':"<td "+(e.paid!='true'?' style="background-color:red;"':'')+"><a href=\"javascript:apporteurfactures.modal('#modal', { title : 'Modifier facture', hidden: { id: "+e.id+" } });\">",'cell_close':'</a></td>','cells':[e.date,'#'+e.invoice_number,e.name,showPrice(e.commission),e.sale,e.agent]});output.push({infinitescroll:e.infinitescroll,html:html});}this.list(a,output,c);};apporteurfactures.form=function(){return [{type:'input',field:'invoice_number',title:'Numero facture'},[[{type:'select2',field:'agent_id',title:'Agent',required:true,options:myagency.options('fullname')}],[{type:'select2',field:'sale_id',title:'Vente',required:true,options:notairefactures.options('description')}]],[[{type:'input',field:'name',title:'Nom',required:true}],[{type:'input',field:'siret',title:'SIRET'}]],{type:'input',field:'address',title:'Adresse',required:true},[[{type:'input',field:'iban',title:'IBAN',required:true}],[{type:'input',field:'bic',title:'BIC'}]],[[{type:'input',field:'commission',title:'Commission',required:true}],[{type:'boolean',field:'vat',title:'TVA inclus','default':'true'}],[{type:'boolean',field:'paid',title:'Paid','default':'false'}]],{type:'date',field:'date',title:'Date du facture',required:true}];};
/*! financesummary.js - Author: BienFacile, License: Bienfacile, more info: http://www.bienfacile.com/ */
notairefactures.summary=function(a,b,c){c.isotope=false;output=[];c.wrapper='table';c.wrapper_class='table table-striped';c.childwrapper='tr';var b=notairefactures.data;var d={},e,f,g,h,i=false,j=false;for(var k=0;k<b.length;k++){h=b[k];g=h.date.substring(0,7);f=parseInt(h.date.substring(0,4));if(g in d)d[g].amount=d[g].amount+parseInt(h.commission);else d[g]={'amount':parseInt(h.commission),'month':g,'year':false};if(!i||i>f)i=f;if(!j||j<f)j=f;}for(var l=j;l>i-1;l--){html=concat_cells({'cell_open':"<td><b>",'cell_close':'</b></td>','cells':[l.toString(),'Commission','TVA','Net']});output.push({infinitescroll:h.infinitescroll,html:html});e=0;for(var m=1;m<13;m++){g=l.toString()+'-'+m.toString().padStart(2,'0');if(g in d){h=d[g];e=e+h.amount;}else h={'amount':false,'month':g};html=concat_cells({'cell_open':"<td>",'cell_close':'</td>','cells':[monthname(m),(h.amount?showPrice(h.amount):'-'),(h.amount?showPrice(h.amount-h.amount/1.2):'-'),(h.amount?showPrice(h.amount/1.2):'-')]});output.push({infinitescroll:h.infinitescroll,html:html});}html=concat_cells({'cell_open':"<td><i>",'cell_close':'</i></td>','cells':['Total',(e?showPrice(e):'-'),(e?showPrice(e-e/1.2):'-'),(e?showPrice(e/1.2):'-')]});output.push({infinitescroll:h.infinitescroll,html:html});}this.list(a,output,c);};suppliers_facture.summary=function(a,b,c){c.isotope=false;output=[];c.wrapper='table';c.wrapper_class='table table-striped';c.childwrapper='tr';var b=suppliers_facture.data;var d={},e,f,g,h,i,j,k,l=false,m=false;for(var n=0;n<b.length;n++){k=b[n];i=k.date.substring(0,7);h=parseInt(k.date.substring(0,4));if(i in d)d[i].amount=d[i].amount+parseInt(k.amount);else d[i]={'amount':parseInt(k.amount),'month':i,'vat':k.vat};if(!l||l>h)l=h;if(!m||m<h)m=h;}for(var o=m;o>l-1;o--){html=concat_cells({'cell_open':"<td><b>",'cell_close':'</b></td>','cells':[o.toString(),'Commission','TVA','Net']});output.push({infinitescroll:k.infinitescroll,html:html});e=0;f=0;g=0;for(var p=1;p<13;p++){i=o.toString()+'-'+p.toString().padStart(2,'0');if(i in d){k=d[i];e=e+k.amount;f=f+(k.vat?(k.amount-k.amount/1.2):0);g=g+(k.vat?k.amount/1.2:k.amount);}else k={'amount':false,'month':i};html=concat_cells({'cell_open':"<td>",'cell_close':'</td>','cells':[monthname(p),(k.amount?showPrice(k.amount):'-'),(k.amount?showPrice(k.amount-k.amount/1.2):'-'),(k.amount?showPrice(k.amount/1.2):'-')]});output.push({infinitescroll:k.infinitescroll,html:html});}html=concat_cells({'cell_open':"<td><i>",'cell_close':'</i></td>','cells':['Total',showPrice(e),showPrice(f),showPrice(g)]});output.push({infinitescroll:k.infinitescroll,html:html});}this.list(a,output,c);};